<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Imagens - Google/Bing</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-3xl shadow-2xl p-8 mb-6">
            <h1 class="text-4xl font-bold text-purple-800 mb-3">
                üîç Buscar Imagens via Google/Bing
            </h1>
            <p class="text-xl text-gray-600 mb-4">
                Busca imagens reais dos produtos usando motores de busca
            </p>
            
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                <p class="text-blue-800 font-semibold">üí° Como Funciona:</p>
                <ul class="text-blue-700 text-sm mt-2 space-y-1">
                    <li>‚úÖ <strong>Serpstack API (Google):</strong> Busca imagens via Google Images</li>
                    <li>‚úÖ <strong>SerpAPI:</strong> API robusta com plano gratuito (100 buscas/m√™s)</li>
                    <li>‚úÖ <strong>ScraperAPI:</strong> Alternativa com bypass de CORS</li>
                    <li>‚ö†Ô∏è <strong>Requer API Key:</strong> Gratuita, mas precisa cadastro</li>
                </ul>
            </div>

            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                <p class="text-yellow-800 font-semibold">üìù APIs Dispon√≠veis (escolha uma):</p>
                <div class="text-yellow-700 text-sm mt-2 space-y-2">
                    <p><strong>1. SerpAPI</strong> (Recomendado)</p>
                    <ul class="ml-4 list-disc">
                        <li>Site: <a href="https://serpapi.com" target="_blank" class="underline">serpapi.com</a></li>
                        <li>Plano gr√°tis: 100 buscas/m√™s</li>
                        <li>Cadastro simples com email</li>
                    </ul>
                    
                    <p class="mt-3"><strong>2. ScraperAPI</strong></p>
                    <ul class="ml-4 list-disc">
                        <li>Site: <a href="https://scraperapi.com" target="_blank" class="underline">scraperapi.com</a></li>
                        <li>Plano gr√°tis: 1000 requisi√ß√µes/m√™s</li>
                        <li>N√£o espec√≠fico para imagens, mas funciona</li>
                    </ul>

                    <p class="mt-3"><strong>3. M√©todo Manual (Sem API)</strong></p>
                    <ul class="ml-4 list-disc">
                        <li>Busca manual no Google Images</li>
                        <li>Copiar URL da imagem</li>
                        <li>100% gratuito, mas trabalhoso</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- API Key Input -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">üîë Passo 1: Configure a API</h3>
            
            <div class="bg-yellow-50 border border-yellow-300 rounded-lg p-4 mb-4">
                <p class="text-yellow-800 font-semibold">‚ö†Ô∏è IMPORTANTE: Escolha uma op√ß√£o</p>
                <ul class="text-yellow-700 text-sm mt-2 space-y-1">
                    <li>üìå <strong>Op√ß√£o A:</strong> Use SerpAPI (100 buscas gr√°tis/m√™s) - Recomendado</li>
                    <li>üìå <strong>Op√ß√£o B:</strong> M√©todo Manual (100% gr√°tis, mas mais lento)</li>
                </ul>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Escolha o m√©todo:
                    </label>
                    <select id="api-type" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-lg font-semibold">
                        <option value="">-- Selecione --</option>
                        <option value="serpapi">ü§ñ SerpAPI (100 gr√°tis + Autom√°tico)</option>
                        <option value="manual">‚úèÔ∏è Manual (100% Gr√°tis + Lento)</option>
                    </select>
                </div>
                
                <div id="api-key-container" style="display: none;">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Cole sua API Key aqui:
                    </label>
                    <input type="text" id="api-key" placeholder="Exemplo: 1234abcd5678efgh..." 
                           class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 font-mono text-sm">
                    <div class="mt-2 flex items-center gap-2">
                        <button onclick="testarAPIKey()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                            ‚úì Testar API Key
                        </button>
                        <a href="https://serpapi.com/manage-api-key" target="_blank" class="text-blue-600 underline text-sm">
                            Obter API Key ‚Üí
                        </a>
                    </div>
                    <p id="api-status" class="text-sm mt-2"></p>
                </div>
            </div>

            <div id="instrucoes-serpapi" class="hidden bg-blue-50 border border-blue-300 rounded-lg p-4">
                <p class="text-blue-800 font-semibold mb-2">üìã Como obter API Key SerpAPI (2 minutos):</p>
                <ol class="text-blue-700 text-sm space-y-2 ml-4 list-decimal">
                    <li>Clique em: <a href="https://serpapi.com/users/sign_up" target="_blank" class="underline font-semibold">Cadastrar no SerpAPI</a></li>
                    <li>Preencha email e senha (sem cart√£o de cr√©dito)</li>
                    <li>Confirme o email que receber√°</li>
                    <li>Acesse: <a href="https://serpapi.com/manage-api-key" target="_blank" class="underline font-semibold">Sua API Key</a></li>
                    <li>Copie e cole no campo acima</li>
                    <li>Clique em "Testar API Key"</li>
                </ol>
            </div>

            <div id="instrucoes-manual" class="hidden bg-green-50 border border-green-300 rounded-lg p-4">
                <p class="text-green-800 font-semibold mb-2">‚úèÔ∏è Modo Manual Selecionado:</p>
                <p class="text-green-700 text-sm">
                    Voc√™ ter√° que buscar cada imagem manualmente no Google Images e copiar a URL. 
                    N√£o precisa de API Key. Clique em "Carregar Produtos" para continuar.
                </p>
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
            <div class="bg-white rounded-xl p-4 shadow-lg text-center">
                <div class="text-3xl font-bold text-purple-700" id="total">0</div>
                <div class="text-sm text-gray-600">Total</div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-lg text-center">
                <div class="text-3xl font-bold text-green-700" id="completos">0</div>
                <div class="text-sm text-gray-600">Com Imagem</div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-lg text-center">
                <div class="text-3xl font-bold text-yellow-700" id="pendentes">0</div>
                <div class="text-sm text-gray-600">Pendentes</div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-lg text-center">
                <div class="text-3xl font-bold text-blue-700" id="processadas">0</div>
                <div class="text-sm text-gray-600">Processadas</div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-lg text-center">
                <div class="text-3xl font-bold text-orange-700" id="progresso">0%</div>
                <div class="text-sm text-gray-600">Progresso</div>
            </div>
        </div>

        <!-- Controls -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">üöÄ Passo 2: Processar Produtos</h3>
            <div class="grid md:grid-cols-3 gap-4">
                <button onclick="carregarProdutos()" id="btn-carregar" disabled class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed">
                    üì¶ 1. Carregar Produtos
                </button>
                <button onclick="buscarTodasImagens()" id="btn-buscar" disabled class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed">
                    üöÄ 2. Buscar Todas
                </button>
                <button onclick="exportarJSON()" id="btn-exportar" disabled class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed">
                    üíæ 3. Exportar JSON
                </button>
            </div>
            <p class="text-sm text-gray-500 mt-3 text-center">
                ‚¨ÜÔ∏è Configure a API primeiro para habilitar os bot√µes
            </p>
        </div>

        <!-- Progress -->
        <div id="progress-box" class="hidden bg-white rounded-2xl shadow-xl p-6 mb-6">
            <div class="flex justify-between mb-2">
                <span class="font-semibold text-gray-700" id="progress-status">Processando...</span>
                <span id="progress-text" class="text-gray-600">0 / 0</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4">
                <div id="progress-bar" class="bg-gradient-to-r from-green-500 to-green-600 h-4 rounded-full transition-all" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-500 mt-2" id="progress-detail"></p>
        </div>

        <!-- Products -->
        <div id="products" class="space-y-4"></div>
    </div>

    <!-- Modal de Sele√ß√£o de Imagem -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold" id="modal-title">Selecione uma Imagem</h3>
                    <button onclick="fecharModal()" class="text-gray-500 hover:text-gray-700 text-3xl">&times;</button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]">
                <div id="modal-images" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
            </div>
        </div>
    </div>

    <script src="produtos-v6.1.js"></script>
    <script>
        let produtos = [];
        let processadas = 0;
        let produtoAtual = null;

        function isPlaceholder(url) {
            if (!url) return true;
            return url.includes('placeholder') || url.includes('placehold');
        }

        function atualizarStats() {
            const total = produtos.length;
            const completos = produtos.filter(p => !isPlaceholder(p.imagem)).length;
            const pendentes = total - completos;
            const prog = total > 0 ? Math.round((completos / total) * 100) : 0;

            document.getElementById('total').textContent = total;
            document.getElementById('completos').textContent = completos;
            document.getElementById('pendentes').textContent = pendentes;
            document.getElementById('processadas').textContent = processadas;
            document.getElementById('progresso').textContent = prog + '%';
        }

        function carregarProdutos() {
            try {
                let todos = [];
                
                if (typeof produtosPlanilha !== 'undefined') {
                    todos = todos.concat(produtosPlanilha);
                }
                
                if (typeof produtosSugeridos !== 'undefined') {
                    todos = todos.concat(produtosSugeridos);
                }
                
                if (todos.length === 0) {
                    alert('‚ùå Erro: produtos-v6.1.js n√£o carregado!');
                    return;
                }
                
                produtos = todos;
                atualizarStats();
                renderizar();
                
                document.getElementById('btn-buscar').disabled = false;
                document.getElementById('btn-exportar').disabled = false;
                
                alert(`‚úÖ ${produtos.length} produtos carregados!\n\nPr√≥ximos passos:\n1. Configure a API (ou escolha Manual)\n2. Clique "Buscar Todas"`);
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao carregar: ' + error.message);
            }
        }

        function renderizar() {
            const container = document.getElementById('products');
            
            if (produtos.length === 0) {
                container.innerHTML = '<div class="bg-yellow-100 p-4 rounded text-center">Clique em "Carregar Produtos"</div>';
                return;
            }
            
            container.innerHTML = produtos.slice(0, 50).map((p, i) => {
                const temImagem = !isPlaceholder(p.imagem);
                const img = temImagem ? p.imagem : 'https://via.placeholder.com/200x200/6366f1/ffffff?text=Sem+Imagem';
                const linkCurto = p.linkCompra ? p.linkCompra.substring(0, 60) : 'Sem link';
                
                return `
                    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all">
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="flex-shrink-0">
                                <img src="${img}" class="w-48 h-48 object-contain bg-gray-50 rounded-xl p-4 border-2 border-gray-200" 
                                     onerror="this.src='https://via.placeholder.com/200x200/ef4444/ffffff?text=Erro'">
                            </div>
                            <div class="flex-1">
                                <div class="flex gap-2 mb-3">
                                    <span class="px-3 py-1 rounded-full text-sm font-semibold ${temImagem ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                        ${temImagem ? '‚úì Com Imagem' : '‚è≥ Pendente'}
                                    </span>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700">
                                        #${i + 1}
                                    </span>
                                </div>
                                
                                <h3 class="text-xl font-bold text-gray-800 mb-2">${p.nome}</h3>
                                
                                ${p.categoria || p.subcategoria ? `
                                    <div class="flex gap-2 mb-2">
                                        ${p.categoria ? `<span class="text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded">${p.categoria}</span>` : ''}
                                        ${p.subcategoria ? `<span class="text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded">${p.subcategoria}</span>` : ''}
                                    </div>
                                ` : ''}
                                
                                ${p.precoCompra ? `
                                    <p class="text-lg font-bold text-green-600 mb-2">
                                        R$ ${p.precoCompra.toFixed(2)}
                                    </p>
                                ` : ''}
                                
                                ${p.linkCompra ? `
                                    <a href="${p.linkCompra}" target="_blank" 
                                       class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 text-sm mb-3 hover:underline">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                        <span class="truncate max-w-md">${linkCurto}...</span>
                                    </a>
                                ` : '<p class="text-gray-400 text-sm mb-3">Sem link</p>'}
                                
                                <div class="flex flex-wrap gap-2 mt-4">
                                    <button onclick="buscarImagem(${i})" 
                                            class="flex-1 min-w-[120px] bg-blue-500 hover:bg-blue-600 text-white font-medium px-4 py-2 rounded-lg transition-all shadow hover:shadow-lg">
                                        üîç Buscar Google
                                    </button>
                                    <button onclick="inserirManual(${i})" 
                                            class="flex-1 min-w-[120px] bg-green-500 hover:bg-green-600 text-white font-medium px-4 py-2 rounded-lg transition-all shadow hover:shadow-lg">
                                        ‚úèÔ∏è Manual
                                    </button>
                                    ${p.linkCompra ? `
                                        <button onclick="window.open('${p.linkCompra}', '_blank')" 
                                                class="flex-1 min-w-[120px] bg-purple-500 hover:bg-purple-600 text-white font-medium px-4 py-2 rounded-lg transition-all shadow hover:shadow-lg">
                                            üõí Ver Produto
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('') + (produtos.length > 50 ? `
                <div class="bg-gradient-to-r from-blue-100 to-purple-100 p-6 rounded-2xl text-center shadow-lg">
                    <p class="text-lg font-semibold text-gray-700">
                        ... e mais ${produtos.length - 50} produtos
                    </p>
                    <p class="text-sm text-gray-600 mt-2">
                        Role para cima para ver todos ou use "Buscar Todas" para processar em lote
                    </p>
                </div>
            ` : '');
        }

        async function buscarImagem(index) {
            const produto = produtos[index];
            const apiType = document.getElementById('api-type').value;
            
            if (apiType === 'manual') {
                inserirManual(index);
                return;
            }
            
            const apiKey = document.getElementById('api-key').value.trim();
            if (!apiKey) {
                alert('‚ùå Insira sua API Key do SerpAPI!\n\nObtenha em: https://serpapi.com/manage-api-key');
                return;
            }
            
            try {
                document.getElementById('progress-detail').textContent = `Buscando: ${produto.nome}`;
                
                // Extrair nome limpo do produto
                const nomeLimpo = produto.nome
                    .replace(/[üî•üíé‚≠ê‚ú®]/g, '')
                    .replace(/\(.*?\)/g, '')
                    .trim();
                
                // SerpAPI - Google Images
                const url = `https://serpapi.com/search.json?engine=google_images&q=${encodeURIComponent(nomeLimpo + ' produto')}&api_key=${apiKey}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.images_results && data.images_results.length > 0) {
                    mostrarModalImagens(data.images_results, index);
                } else {
                    alert('‚ùå Nenhuma imagem encontrada.\n\nTente:\n1. M√©todo manual\n2. Refinar o nome do produto');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao buscar imagem.\n\nVerifique:\n1. API Key v√°lida\n2. Conex√£o com internet\n3. Limite de requisi√ß√µes');
            }
        }

        function mostrarModalImagens(imagens, produtoIndex) {
            produtoAtual = produtoIndex;
            const modal = document.getElementById('modal');
            const container = document.getElementById('modal-images');
            const title = document.getElementById('modal-title');
            
            title.textContent = `Selecione uma imagem para: ${produtos[produtoIndex].nome}`;
            
            container.innerHTML = imagens.slice(0, 12).map((img, i) => `
                <div onclick="selecionarImagem('${img.original}')" class="cursor-pointer border-2 border-gray-200 hover:border-purple-500 rounded-lg p-2 transition-all">
                    <img src="${img.thumbnail}" class="w-full h-40 object-cover rounded">
                </div>
            `).join('');
            
            modal.classList.remove('hidden');
        }

        function selecionarImagem(url) {
            if (produtoAtual !== null) {
                produtos[produtoAtual].imagem = url;
                processadas++;
                atualizarStats();
                renderizar();
                fecharModal();
                alert('‚úÖ Imagem selecionada!');
            }
        }

        function fecharModal() {
            document.getElementById('modal').classList.add('hidden');
            produtoAtual = null;
        }

        function inserirManual(index) {
            const produto = produtos[index];
            const url = prompt(`üìù Cole a URL da imagem do produto:\n\n${produto.nome}`);
            
            if (url && url.trim()) {
                produtos[index].imagem = url.trim();
                processadas++;
                atualizarStats();
                renderizar();
                alert('‚úÖ Imagem atualizada!');
            }
        }

        async function buscarTodasImagens() {
            const apiType = document.getElementById('api-type').value;
            const semImagem = produtos.filter(p => isPlaceholder(p.imagem));
            
            if (semImagem.length === 0) {
                alert('‚úÖ Todos os produtos j√° t√™m imagem!');
                return;
            }
            
            if (apiType === 'manual') {
                alert('‚ö†Ô∏è Modo Manual selecionado.\n\nPara buscar todas automaticamente:\n1. Escolha "SerpAPI"\n2. Insira sua API Key\n3. Tente novamente');
                return;
            }
            
            const apiKey = document.getElementById('api-key').value.trim();
            if (!apiKey) {
                alert('‚ùå Insira sua API Key do SerpAPI!');
                return;
            }
            
            if (!confirm(`üöÄ Buscar imagens para ${semImagem.length} produtos?\n\n‚ö†Ô∏è Isso consumir√° ${semImagem.length} requisi√ß√µes da sua API.\n\nPlano gr√°tis: 100/m√™s\n\nContinuar?`)) {
                return;
            }
            
            const progressBox = document.getElementById('progress-box');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progressStatus = document.getElementById('progress-status');
            const progressDetail = document.getElementById('progress-detail');
            
            progressBox.classList.remove('hidden');
            
            let sucessos = 0;
            let falhas = 0;
            
            for (let i = 0; i < produtos.length; i++) {
                if (!isPlaceholder(produtos[i].imagem)) continue;
                
                progressText.textContent = `${sucessos + falhas} / ${semImagem.length}`;
                progressBar.style.width = `${((sucessos + falhas) / semImagem.length) * 100}%`;
                progressStatus.textContent = `Processando produto ${sucessos + falhas + 1}...`;
                progressDetail.textContent = produtos[i].nome;
                
                try {
                    const nomeLimpo = produtos[i].nome
                        .replace(/[üî•üíé‚≠ê‚ú®]/g, '')
                        .replace(/\(.*?\)/g, '')
                        .trim();
                    
                    const url = `https://serpapi.com/search.json?engine=google_images&q=${encodeURIComponent(nomeLimpo + ' produto')}&api_key=${apiKey}`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.images_results && data.images_results.length > 0) {
                        produtos[i].imagem = data.images_results[0].original;
                        sucessos++;
                        processadas++;
                    } else {
                        falhas++;
                    }
                    
                    // Delay para n√£o exceder rate limit
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                } catch (error) {
                    console.error('Erro:', error);
                    falhas++;
                }
            }
            
            progressBox.classList.add('hidden');
            atualizarStats();
            renderizar();
            
            alert(`‚úÖ Processo conclu√≠do!\n\n‚úì Sucessos: ${sucessos}\n‚úó Falhas: ${falhas}\n\nProdutos com falha podem ser inseridos manualmente.`);
        }

        function exportarJSON() {
            const data = new Date().toISOString().split('T')[0];
            const json = JSON.stringify(produtos, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `produtos-imagens-${data}.json`;
            a.click();
            
            const completos = produtos.filter(p => !isPlaceholder(p.imagem)).length;
            alert(`‚úÖ Exportado!\n\nArquivo: produtos-imagens-${data}.json\nCompletos: ${completos}/${produtos.length}`);
        }

        // Fun√ß√£o para testar API Key
        async function testarAPIKey() {
            const apiKey = document.getElementById('api-key').value.trim();
            const status = document.getElementById('api-status');
            
            if (!apiKey) {
                status.innerHTML = '<span class="text-red-600">‚ùå Cole a API Key primeiro</span>';
                return;
            }
            
            status.innerHTML = '<span class="text-blue-600">üîÑ Testando...</span>';
            
            try {
                const response = await fetch(`https://serpapi.com/search.json?engine=google&q=test&api_key=${apiKey}`);
                const data = await response.json();
                
                if (data.search_metadata && data.search_metadata.status === 'Success') {
                    status.innerHTML = '<span class="text-green-600 font-semibold">‚úÖ API Key v√°lida! Pode continuar.</span>';
                    localStorage.setItem('serpapi_key', apiKey); // Salva no navegador
                } else if (data.error) {
                    status.innerHTML = `<span class="text-red-600">‚ùå Erro: ${data.error}</span>`;
                } else {
                    status.innerHTML = '<span class="text-red-600">‚ùå API Key inv√°lida</span>';
                }
            } catch (error) {
                status.innerHTML = '<span class="text-red-600">‚ùå Erro ao testar. Verifique a API Key.</span>';
            }
        }

        // Mostrar/ocultar campos conforme sele√ß√£o
        document.getElementById('api-type').addEventListener('change', function() {
            const container = document.getElementById('api-key-container');
            const instrucoesSerpapi = document.getElementById('instrucoes-serpapi');
            const instrucoesManual = document.getElementById('instrucoes-manual');
            const btnCarregar = document.getElementById('btn-carregar');
            
            if (this.value === 'serpapi') {
                container.style.display = 'block';
                instrucoesSerpapi.classList.remove('hidden');
                instrucoesManual.classList.add('hidden');
                btnCarregar.disabled = false; // Habilita bot√£o carregar
                
                // Tentar carregar API Key salva
                const savedKey = localStorage.getItem('serpapi_key');
                if (savedKey) {
                    document.getElementById('api-key').value = savedKey;
                    document.getElementById('api-status').innerHTML = '<span class="text-blue-600">üí° API Key carregada do navegador. Clique "Testar" para validar.</span>';
                }
            } else if (this.value === 'manual') {
                container.style.display = 'none';
                instrucoesSerpapi.classList.add('hidden');
                instrucoesManual.classList.remove('hidden');
                btnCarregar.disabled = false; // Habilita bot√£o carregar
            } else {
                container.style.display = 'none';
                instrucoesSerpapi.classList.add('hidden');
                instrucoesManual.classList.add('hidden');
                btnCarregar.disabled = true; // Desabilita se n√£o escolheu
            }
        });
    </script>
</body>
</html>
